<!DOCTYPE html>
<html>
<head>
  <meta name="generator" content=
  "HTML Tidy for HTML5 for Linux version 5.8.0">
  <title>Login VulBox</title>

</head>
<body>
  <h2>VulBox file browser</h2>
  <form id ="uploadElem">
    <input type="text" id="text-input" placeholder="Place">
    <input type="button" onclick="getTemperature();" id="text-input" value="Search">
  </form>
  <form id ="uploadElem">
    <input type="text" id="text-input2" placeholder="Place">
    <input type="button" onclick="getPercipitation();" id="text-input2" value="Search">
  </form>

  <h3> Important Resources</h3>

  <a href="https://api.met.no/weatherapi/locationforecast/2.0/#/"> Weather</a>
  <a href="https://api.met.no/doc/ForecastJSON"> Weather</a>
  <br>
  <a href="https://geocode.maps.co/"> geolocationAPI</a>
  <a href="https://openweathermap.org/api/geocoding-api"> geolocationAPI</a>
  <br>
  <a href="https://www.gpskoordinaten.de/"> gpskoordinaten</a>
<p>Your are in: /{{path_dir}}</p>
  <footer>
    <p>© Felix Schärtl</p>
  </footer>


  <script>

      async function getInputValue(lat, lon) {
        // Selecting the input element and get its value 
        // Displaying the value
        // alert(inputVal);

        /* Split input in two lat and lon
        var arr = inputVal.split(" ");
        console.log(`${arr[0]} and ${arr[1]}`);
        */
               
        let url = 'https://api.met.no/weatherapi/locationforecast/2.0/complete?lat=' + lat + '&lon=' + lon;
        //let url = 'https://api.met.no/weatherapi/locationforecast/2.0/complete?lat=49.67&lon=12.17';


        let response = await fetch(url);
        let commits = await response.json(); // read response body and parse as JSON

        
        //let json = JSON.stringify(commits);
        //console.log(json);
      
        /*
        console.log(commits["properties"]["meta"]["units"]["air_pressure_at_sea_level"]);
        console.log(Object.keys(commits["properties"]));
        console.log(`Coordinates: ${commits["geometry"]["coordinates"]}`);
        console.log(`Update: ${commits["properties"]["meta"]["updated_at"]}`);
        */

        //console.log(commits["properties"]["timeseries"][0]["data"]["next_6_hours"]["details"]["precipitation_amount"]);

        return commits;

      };

      async function geolocation(lat, let){

        let url = 'https://geocode.maps.co/reverse?lat=' + lat + '&lon=' + let;

        let response = await fetch(url);
        let commits = await response.json(); // read response body and parse as JSON

        return commits;

      }


      async function getTemperature(){


        let inputVal = document.getElementById("text-input").value;

        var arr = inputVal.split(" ");

        var lat = parseFloat(arr[0].replace(".", "."));
        var let = parseFloat(arr[1].replace(".", "."));

        for (t = 0; t<=5; t++){
          for (k = 0; k <= 5; k++){

            lat = lat + 1/20;
            let = let + 1/20;
            let geo_data = await geolocation(lat, let);
            let data = await getInputValue(lat, let);

            let temp = [0, 0,0];
            
            for (let j = 0; j <= 2; j++){
              for (let i = 4; i <= 8; i++) {
                temp[j] = temp[j] + data["properties"]["timeseries"][i+j*24]["data"]["instant"]["details"]["air_temperature"];
              }
            }
            console.log(`Place: ${geo_data["address"]["county"]} (Lat: ${lat}, Let: ${let}`);

            for (let k = 0; k<=2; k++){
              console.log(`Average Temperature for the ${data["properties"]["timeseries"][k+k*24]["time"].slice(0,10)} is: ${temp[k]/5}`);
            }
          }
        }
      };




      async function getPercipitation(){


        let inputVal = document.getElementById("text-input2").value;

        var arr = inputVal.split(" ");

        var lat = parseFloat(arr[0].replace(".", "."));
        var let = parseFloat(arr[1].replace(".", "."));

        for (t = 0; t<=5; t++){
          for (k = 0; k <= 5; k++){

            lat = lat + 1/20;
            let = let + 1/20;
            let geo_data = await geolocation(lat, let);
            let data = await getInputValue(lat, let);

            let perc = [0, 0 ];
            
            for (let j = 0; j <= 2; j++){
              for (let i = 4; i <= 8; i++) {
                perc[j] = perc[j] + data["properties"]["timeseries"][i+j*24]["data"]["next_6_hours"]["details"]["precipitation_amount"];
              }
            }
            console.log(`Place: ${geo_data["address"]["county"]} (Lat: ${lat}, Let: ${let}`);

            for (let k = 0; k<=2; k++){
              console.log(`Average Percipitation for the ${data["properties"]["timeseries"][k+k*24]["time"].slice(0,10)} is: ${perc[k]/5}`);
            }
          }
        }
      }

  </script>
</body>
</html>

